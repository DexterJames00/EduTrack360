<!DOCTYPE html>
<html>
<head>
    <title>BULLETPROOF Real-time Logs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .log-item { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">üöÄ BULLETPROOF Real-time Activity Logs</h1>
        
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <p class="text-green-600 font-semibold">
                Status: <span id="status">Loading...</span> 
                | Last Update: <span id="lastUpdate">Never</span>
                | Updates: <span id="updateCount">0</span>
            </p>
        </div>
        
        <div class="bg-white rounded-lg shadow">
            <div class="p-4 border-b">
                <h2 class="text-xl font-semibold">Recent Activity</h2>
            </div>
            <div id="logsContainer" class="p-4">
                <p class="text-gray-500">Loading logs...</p>
            </div>
        </div>
    </div>

    <script>
        let updateCount = 0;
        const statusEl = document.getElementById('status');
        const lastUpdateEl = document.getElementById('lastUpdate');
        const updateCountEl = document.getElementById('updateCount');
        const logsContainer = document.getElementById('logsContainer');
        
        console.log('üöÄ BULLETPROOF logs starting...');
        
        function updateStatus(message) {
            statusEl.textContent = message;
            lastUpdateEl.textContent = new Date().toLocaleTimeString();
            updateCount++;
            updateCountEl.textContent = updateCount;
            console.log(`üîÑ Update ${updateCount}: ${message}`);
        }
        
        function loadLogs() {
            updateStatus('Refreshing...');
            
            fetch('/school_admin/logs/api/logs')
                .then(response => response.json())
                .then(data => {
                    updateStatus('‚úÖ Active - Auto-refresh every 2 seconds');
                    
                    if (data.logs && data.logs.length > 0) {
                        logsContainer.innerHTML = data.logs.slice(0, 10).map(log => `
                            <div class="log-item border-b py-2">
                                <div class="flex justify-between">
                                    <span class="font-semibold">${log.username}</span>
                                    <span class="text-gray-500 text-sm">${new Date(log.timestamp).toLocaleString()}</span>
                                </div>
                                <div class="text-sm text-gray-600">
                                    ${log.action} ${log.entity_type} - ${log.entity_name}
                                </div>
                            </div>
                        `).join('');
                    } else {
                        logsContainer.innerHTML = '<p class="text-gray-500">No logs yet</p>';
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error loading logs:', error);
                    updateStatus('‚ùå Error loading logs');
                    logsContainer.innerHTML = '<p class="text-red-500">Error loading logs</p>';
                });
        }
        
        // GUARANTEED REFRESH: Every 2 seconds, no matter what!
        setInterval(loadLogs, 2000);
        
        // Initial load
        loadLogs();
        
        console.log('‚úÖ BULLETPROOF refresh started - every 2 seconds');
    </script>
</body>
</html>